# Les tests avec Cucumber

----

## Bibliothèques

```xml
<cucumber.version>7.11.1</cucumber.version>
<dependency>
	<groupId>org.junit.platform</groupId>
	<artifactId>junit-platform-suite</artifactId>
	<scope>test</scope>
</dependency>
<dependency>
	<groupId>io.cucumber</groupId>
	<artifactId>cucumber-spring</artifactId>
	<version>${cucumber.version}</version>
	<scope>test</scope>
</dependency>
<dependency>
	<groupId>io.cucumber</groupId>
	<artifactId>cucumber-java</artifactId>
	<version>${cucumber.version}</version>
	<scope>test</scope>
</dependency>
<dependency>
	<groupId>io.cucumber</groupId>
	<artifactId>cucumber-junit-platform-engine</artifactId>
	<version>${cucumber.version}</version>
	<scope>test</scope>
</dependency>
```

----

## Configuration 

```java
@SpringBootTest
@AutoConfigureMockMvc(print = MockMvcPrint.NONE)
@TestPropertySource(
        properties = {
            "spring.datasource.driver-class-name=org.h2.Driver",
            "spring.datasource.url=jdbc:h2:mem:testdb"
        })
@CucumberContextConfiguration
public class SpringBootIT {}


import static io.cucumber.junit.platform.engine.Constants.GLUE_PROPERTY_NAME;
import static io.cucumber.junit.platform.engine.Constants.PLUGIN_PROPERTY_NAME;

// utilisation la plateforme Junit pour exécuter nos scénarios
@Suite
@IncludeEngines("cucumber")
// les fichiers .feature sont dans le dossier features des ressources de tests
@SelectClasspathResource("features")
// les Steps et la config Spring seront à chercher dans le package indiqué ici
@ConfigurationParameter(key = GLUE_PROPERTY_NAME, value = "fr.insee.formationapirest")
@ConfigurationParameter(key = PLUGIN_PROPERTY_NAME, value = "pretty, json:target/cucumber.json, html:target/reports/cucumber/rapport.html,"
                + " usage:target/usage.jsonx, junit:target/junit.xml")
public class CucumberRunnerIT {
}

```

----

## Création de features

```gherkin
Feature: Obtenir les vins

    Background: création d'un jeu de données pour vérifier les données renvoyées
        Given des vins avec les attributs suivants
            | chateau   | appellation  | prix |
            | Château 1 | Saint-Julien | 10.5 |
            | Château 2 | Pomerol      | 25   |

    Scenario: obtenir tous les vins quand il y a un vin en base
        When je récupère tous les vins
        Then le nombre de vins est 2
        Then le vin du chateau "Château 1" à 10.5€ est renvoyé
        Then le vin du chateau "Château 2" à 25€ est renvoyé

```

----

## Création d'une glue

TODO


----

## Utilisation de DataTable

TODO

----

## Ajout d'une bibliothèque pour générer des INSERT

```xml
<dependency>
	<groupId>com.ninja-squad</groupId>
	<artifactId>DbSetup</artifactId>
	<version>2.1.0</version>
</dependency>
```

----

## Méthide générique pour faire des INSERT

TODO

----

## Contrôle des droits d'accès

TODO

